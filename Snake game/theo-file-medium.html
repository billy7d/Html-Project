<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<canvas id="canvas" width="529" height="529" style="border: 1px solid black"></canvas>

<script>
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    window.addEventListener("keydown",huongRanDiChuyenTheoNut);

    let Snake = function () {
        this.grid = 23;                                     //snake width;
        this.doDaiBodyBanDau = 3;                            //do dai ban dai = 3 grid.
        this.toaDoThan = [];
        this.toaDoDauRan = {x:230 , y:230};                // = toa do dau ran.
        this.dX = 23;                                   //di chuyen dau game.
        this.dY = 0;

        this.huongDiChuyen = function () {
            this.toaDoThan[0].x += this.dX;
            this.toaDoThan[0].y += this.dY;
        }

        this.veRan = function () {
            ctx.beginPath();
            ctx.fillStyle='black';
            ctx.rect(this.toaDoDauRan.x, this.toaDoDauRan.y, this.grid, this.grid);
            ctx.stroke();
            }
        this.diChuyenToaDoThan = function () {
            for (let i = this.toaDoThan.length - 1; i > 0; i--) {
                this.toaDoThan[i].x = this.toaDoThan[i - 1].x;
                this.toaDoThan[i].y = this.toaDoThan[i - 1].y;
            }
            for (let i = 0; i < this.toaDoThan.length; i++) {               //ve luon ran
                ctx.beginPath();
                ctx.rect(this.toaDoThan[i].x, this.toaDoThan[i].y, this.grid, this.grid);
                ctx.stroke();
            }
        }
        this.dauChamThan = function () {
            for (let i = 2; i < this.toaDoThan.length; i++) {
                if (this.toaDoThan[0].x == this.toaDoThan[i].x && this.toaDoThan[0].y == this.toaDoThan[i].y) {
                    clearInterval(game);
                    alert("Game over");
                }
            }
        }
         this.eat = function (apple) {
            if (this.toaDoThan[0].x === apple.x && this.toaDoThan[0].y === apple.y){
                this.toaDoThan.push({x:apple.x, y:apple.y});
                apple.x = ((Math.floor(Math.random() * 23)) + 1)* 23;
                apple.y = ((Math.floor(Math.random() * 23)) + 1)* 23;
                apple.veFood();
            }
         }
    }

    let snake = new Snake();
    snake.toaDoThan[0] = snake.toaDoDauRan;



    let Food = function () {
        this.x = ((Math.floor(Math.random() * 20)) + 1)* 23;
        this.y = ((Math.floor(Math.random() * 20)) + 1)* 23;
        this.veFood = function () {

            ctx.beginPath();
            ctx.fillStyle = "yellow";
            ctx.fillRect(this.x,this.y,23,23);
            ctx.stroke();
        }
    }


    let apple = new Food();




    function huongRanDiChuyenTheoNut(evt) {
        switch (evt.keyCode) {
            case 37:
                snake.dX = -23 ;
                snake.dY = 0;
                break;
            case 38:
                snake.dX = 0;
                snake.dY = -23;
                break;
            case 39:
                snake.dX = 23 ;
                snake.dY = 0;
                break;
            case 40:
                snake.dX = 0;
                snake.dY = 23;
                break;
        }
    }

    function damVaoTuong() {
        if (snake.toaDoThan[0].x <0 || snake.toaDoThan[0].x >= canvas.width
            || snake.toaDoThan[0].y < 0 || snake.toaDoThan[0].y >= canvas.height){
                clearInterval(game);
                alert("Game over");
        }
    }



    function loop() {
        snake.huongDiChuyen();
        ctx.clearRect(0,0,canvas.width,canvas.height);
        snake.veRan();
        apple.veFood();
        snake.eat(apple);
        snake.diChuyenToaDoThan();
        damVaoTuong();
        snake.dauChamThan();


    }

let game = setInterval(loop,1000/8);

</script>
</body>
</html>