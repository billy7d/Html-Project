<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="snake.css">
</head>
<body>

<div>Level: <label id="level"></label><br><br>
Score: <label id="score"></label></div>


<canvas id="canvas" width="529" height="529" style="border: 1px solid #a9a9a9"></canvas>

<script>
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    window.addEventListener("keydown",huongRanDiChuyenTheoNut);
    let score = 0;
    let fakeScore = 0;
    let level = 1;
    let frame = 9


    let Snake = function () {
        this.grid = 23;                                     // = snake width
        this.toaDoThan = [];
        this.toaDoDauRan = {x:230 , y:230};
        this.dX = 23;
        this.dY = 0;

        this.diChuyenToaDoThan = function () {
            for (let i = this.toaDoThan.length - 1; i > 0; i--) {
                this.toaDoThan[i].x = this.toaDoThan[i - 1].x;              //dchuyen tdo than
                this.toaDoThan[i].y = this.toaDoThan[i - 1].y;
            }
            this.toaDoThan[0].x += this.dX;                             //dchuyen tdo dau
            this.toaDoThan[0].y += this.dY;
        }
        this.veRan = function () {
            for (let i = 0; i < this.toaDoThan.length; i++) {               //ve ran
                ctx.beginPath();
                ctx.fillStyle = '#0194de';
                ctx.fillRect(this.toaDoThan[i].x, this.toaDoThan[i].y, this.grid, this.grid);
                ctx.rect(this.toaDoThan[i].x, this.toaDoThan[i].y, this.grid, this.grid);
                ctx.stroke();
            }
        }

        this.dauChamThan = function () {
            for (let i= 2; i <this.toaDoThan.length ; i++) {
                if (this.toaDoThan[0].x === this.toaDoThan[i].x && this.toaDoThan[0].y === this.toaDoThan[i].y) {
                    clearInterval(game);
                    alert("Game over");
                }
            }
        }
         this.an = function (apple) {
            if (this.toaDoThan[0].x === apple.x && this.toaDoThan[0].y === apple.y){
                this.toaDoThan.push({x:apple.x, y:apple.y});
                apple.x = ((Math.floor(Math.random() * 20)) + 1)* 23;
                apple.y = ((Math.floor(Math.random() * 20)) + 1)* 23;
                apple.veFood();
                score++;
                fakeScore++;
            }
         }
    }

    let snake = new Snake();
    snake.toaDoThan[0] = snake.toaDoDauRan;


    let Food = function () {
        this.x = ((Math.floor(Math.random() * 20)) + 1)* 23;
        this.y = ((Math.floor(Math.random() * 20)) + 1)* 23;
        this.veFood = function () {
            ctx.beginPath();
            ctx.fillStyle = "yellow";
            ctx.rect(this.x,this.y,23,23);
            ctx.stroke();
            ctx.fill();
        }
    }

    let apple = new Food();

    function huongRanDiChuyenTheoNut(evt) {
        switch (evt.keyCode) {
            case 37:
                snake.dX = -23 ;
                snake.dY = 0;
                break;
            case 38:
                snake.dX = 0;
                snake.dY = -23;
                break;
            case 39:
                snake.dX = 23 ;
                snake.dY = 0;
                break;
            case 40:
                snake.dX = 0;
                snake.dY = 23;
                break;
        }
    }

    function damVaoTuong() {
        if (snake.toaDoThan[0].x <0 || snake.toaDoThan[0].x >= canvas.width
            || snake.toaDoThan[0].y < 0 || snake.toaDoThan[0].y >= canvas.height){
                clearInterval(game);
                alert("Game over");
        }
    }

    function gameScore() {
        document.getElementById("score").innerHTML = score;
    }

    function gameLevel() {
        document.getElementById("level").innerHTML = level;
    }

    function changeSpeed() {
        if (fakeScore>=5){
            frame +=7;
            level++;
            fakeScore =0;
            clearInterval(game);
            game = setInterval(loop,1000/frame);
        }
    }

    function loop() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        apple.veFood();
        snake.an(apple);
        snake.diChuyenToaDoThan();
        snake.veRan();
        snake.dauChamThan();
        damVaoTuong();
        gameScore();
        changeSpeed();
        gameLevel();
    }

let game = setInterval(loop,1000/frame);



</script>
</body>
</html>